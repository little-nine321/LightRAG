(
Weaver
Software
上海市联航路1188号33号楼泛微软件大厦
邮政编码：200122
电话：+86 21
68869298
传真：
+86 21 50942278
) (
泛微协同办公平台E-cology9.0版本后台维护手册(U)--集成
) (
仅限阅读

请勿传播
当您阅读本方案时，即表示您同意不传播本方案的所有内容
)

版权说明

本手册以及相关的计算机软件程序仅用于为泛微协同管理平台最终用户提供信息，上海泛微网络科技股份有限公司有权。本手册是上海泛微网络科技股份有限公司的专有信息，并受中华人民共和国版权法和国际公约的保护。

未得到上海泛微网络科技股份有限公司明确的书面许可，不得为任何目的、以任何形式或手段辅助或传播本手册的任何部分内容。

本手册内容若有变动，恕不另行通知。本手册中例子中所引用的公司、人名和数据若非特殊说明，均属虚构。

本手册以及本手册所提及的任何产品的使用均受适应的最终用户许可协议限制。本手册由上海泛微网络科技股份有限公司制作。本手册中提及的所有商标、商标名称、服务标志及徽标均归其各自公司所有。

目录
前 言	5
一、	关于本手册	5
二、	手册结构	5
三、	针对用户	5
四、	更多资源	5
第1章	数据源设置	6
一、	概述	6
二、	U1-1-数据源设置	6
1.2.1、数据源列表	6
1.2.2、新建数据源	6
三、	U1-2-数据库类型设置	8
1.3.1、数据库类型列表	8
1.3.2、新建数据库类型	9
第2章	WebService注册	10
一、	概述	10
二、	U2-1-注册设置	10
2.2.1、Webservice列表	10
2.2.2、新建Webservice	11
第3章	集成登录	12
一、	概述	12
二、	U3-1-集成登录设置	12
3.2.1、集成登录列表	12
3.2.2、新建集成登录	13
3.2.3、表达式设置	17
3.2.4、表达式参数	19
第4章	计划任务	20
一、	概述	20
二、	U4-1-计划任务设置	20
4.2.1、计划任务页面	20
4.2.2、新建计划任务	21
4.2.3、格式说明	22
第5章	财务凭证	24
一、	概述	24
二、	U5-1-财务凭证设置	24
5.2.1、财务凭证列表	24
5.2.2、新建凭证	24
5.2.3、编辑凭证	25
第6章	数据流转集成	26
一、	概述	26
二、	U6-1-流程接口注册	26
三、	U6-2-注册DML接口	27
6.3.1、基本信息	27
6.3.2、条件设置	29
6.3.3、DML赋值设置	30
6.3.4、自定义DML语句	31
6.3.5、DML赋值设置之转换规则	32
6.3.6、自定义DML语句之获取流程表单字段	33
四、	U6-3-注册WebService接口	33
6.4.1、基本信息	33
6.4.2、返回值	34
6.4.4、参数设置	35
第7章	数据展现集成	35
一、	概述	35
二、	U7-1-数据展现集成设置	35
7.2.1、数据展现集成列表	35
7.2.2、新建数据展现集成	36
第8章	IM集成设置	38
一、	概述	38
二、	U8-1-集成设置	38

前 言
关于本手册
本手册是泛微协同管理平台E-cology9.0基础版本的系统维护手册，主要为了指导用户管理员使用本产品而编写。
手册结构
本手册针对管理员管理泛微协同管理平台E-cology进行详尽描述。
针对用户
本手册针对泛微协同管理平台E-cology的最终用户的系统管理员及模块功能管理员，模块管理员必需具备基本的计算机操作技能，熟悉Windows操作环境并且已经掌握基本的软件操作方法，掌握Internet Explorer浏览器的基本使用，系统管理员还必须对数据库有基本的了解。
更多资源
本手册涵盖泛微协同管理平台E-cology系统功能的后台维护和配置操作指导，如果您能够详细的阅读本手册，就可以对泛微协同管理平台E-cology进行日程的维护工作。同时向用户提供多种帮助资源，以便您能够熟练使用本产品，从而感受到它的快捷易用。您可以根据实际情况，选择其中适应的方式。
应用培训期刊
泛微定期通过电子邮件发送《泛微应用培训期刊》向用户介绍使用泛微软件过程中可能遇到的问题和泛微软件功能应用技巧，提升客户的泛微软件应用水平，加强与泛微客户的广泛交流。
培训
针对大规模企业用户，泛微软件有限公司可为其组织上门培训，培训内容包括：产品功能使用、系统管理员培训、系统应用推广、产品使用技巧等。用户可以自行选择培训时间和内容。
电 话： 021－50942228 转 客户服务部

数据源设置
概述
数据源设置是用来管配置与其它数据库的链接，用来读写其它数据库的数据。
U1-1-数据源设置
1.2.1、数据源列表
点击【数据源设置】菜单后显示如图U1-1-1所示

U1-1-1
新建：创建新的数据源；
批量删除：勾选可删除的数据源，点击此按钮可进行批量删除，删除时需有删除确认对话框，防止误操作；
系统日志：点击后弹出【查看日志】操作界面，显示所有数据源的新建、修改、删除操作日志；
列表菜单：
编辑：修改指定数据源相关参数；
删除：删除指定的这条数据源；
测试：测试这条数据源是否可以正常连接数据库；
日志：这条数据源修改日志记录。
1.2.2、新建数据源
点击【新建】按钮后显示如图U1-1-2

U1-1-2
数据源名称：给数据源起一个名字，在E-cology系统中当用到数据源的时候，就是选择这些名称从而连接到对应的数据库，所以数据源名称是不能重复的；
数据库类型：不同的数据库连接方式是不一样的，所以这里要指定需要连接的数据库的类型，如果这里设置错了，是连接不上指定数据库的，目前默认支持的数据库有sql、oracle、mysql、db2、sybase、informix和hana，如果需要可以在数据库类型设置中自定义增加；
集群/多实例：勾选后支持集群数据库，填写完整的url连接串
oracle集群url举例:  jdbc:oracle:thin:@(description=(address_list= (address=(host=地址) (protocol=tcp)(port=1521))(address=(host=地址)(protocol=tcp) (port=1521)) (load_balance=yes)(failover=yes))(connect_data=(service_name= 服务名)))；
  sqlserver集群使用偏移地址即可；sqlserver多实例：jdbc:sqlserver://地址:端口号;instanceName=实例名;DatabaseName=数据库名
  mysql集群举例：bc:mysql:replication://127.0.0.1:3309,127.0.0.1:3306/core
服务器IP：设置服务器的IP地址，这个地址必需是e-cology系统所在服务器能够访问的地址，简单说就是安装E-cology的服务器和需要连接的数据库服务器之间必需是连通的；
端口号：连接服务器的数据库端口号；
数据库名称：连接服务器的数据库名称，sql数据库就是数据库的名称，Oracle数据库就是实例名；
用户名：可以连接此数据库的用户名；
密码：对应用户名的密码；
连接池：选中时连接数据库采用连接池方案，否则采用数据库直连；
最小连接数：数据库允许的最小连接数；
最大连接数：数据库允许的最大连接数；
显示顺序：设置数据源在应用时的显示顺序。
U1-2-数据库类型设置
1.3.1、数据库类型列表
点击【数据库类型设置】页面后显示如图U1-2-1所示

U1-2-1
新建：创建新的数据库类型；
批量删除：勾选可删除的数据库类型后，点击此按钮可进行批量删除，删除时需有删除确认对话框，防止误操作；系统级的数据库类型不可删除，用户级的数据库类型如果被数据源引用过也不能删除，不可删除的数据库类型行头check框不能选中；
系统日志：点击后弹出【查看日志】操作界面，显示所有数据库类型的新建、修改、删除操作日志；
列表菜单：
编辑：修改指定数据库类型相关参数，系统级数据库类型不显示；
删除：删除指定的这条数据库类型，系统级数据库类型不显示；
查看：查看数据库类型相关参数。
1.3.2、新建数据库类型
点击新建按钮后显示如图U1-2-2所示

U1-2-2
数据库类型：只能输入字母和数字，其他不允许输入，需要进行唯一性检测，不允许重名；
显示名称：可输入各种字符包括中文；
驱动类：输入驱动类，例如：org.gjt.mm.mysql.Driver
连接字符串：输入连接地址模板，例如：jdbc:mysql://[host]:[port]/[dbname]
[host]：代表数据库服务器ip
[port]：代表数据库服务器端口号
[dbname]：代表数据库名称
[servicename]：代表服务名称（informix专用）
允许集群/多实例：勾选后，数据库类型支持集群；
驱动级别：默认为“用户级”，不能修改；
显示顺序：整数(最大9位)，默认为当前最大值+1；
驱动程序：选择本地文件，需要上传连接指定数据库类型的驱动文件。
WebService注册
概述
目前很多软件为了便于和其它软件进行集成，都开发了WebService接口，通过这些接口可以和第三方软件进行数据的交互功能，这里的WebService注册就是在ecology中集中登记其它软件的WebService接口及相关的参数，这样我们在后台管理的时候可以直接调用这些接口。
U2-1-注册设置
2.2.1、Webservice列表
点击【WebService注册】菜单后显示如图U2-1-1所示

U2-1-1
点击【新建】按钮可以注册WebService信息；
选中已注册的WebService后点击【删除】按钮后可以删除选中的信息；
列表菜单只有【编辑】和【删除】按钮，点击后可以编辑删除注册信息。
2.2.2、新建Webservice
在图U2-1-1中点击【新建】按钮后显示如图U2-1-2所示，开始注册WebService信息

U2-1-2
自定义名称中填写WebService服务的名称，在后期调用的时候会看到这个名称，所以命名最后能够代表此WebService服务是干嘛用的；
WebService地址：非常重要的内容，此地址是由第三方软件供应商提供的，如果没有提供就不能使用这个功能，配置完成后可以点击【解析WSDL】以确保接口地址正确，点击【检查更新】按钮可以可以确保接口内容有没有变化；
点击图U2-1-2中的添加按钮，会在下方增加一行，配置WebService接口中提供的方法和参数字段等信息，这些信息都是由第三方软件供应商所需要提供的，如图U2-1-3所示
配置完成后需要点击【保存】按钮进行保存；
选中已有的方法，点击删除按钮可以删除选中的方法；
方法列表字段功能显示如下表，先来看一下图U2-1-3中红框所示的方法所对应的WebService接口文件，如图U2-1-4所示，我们通过浏览器直接访问WebService地址后看到的内容

U2-1-3

U2-1-4
方法名称：其它模块配置过程中可以调用的方法，此方法必需是写在WebService接口内容中的，如图4中的【getAllModeDataList】，所以这些方法都是由提供WebService接口的软件供应商提供；
描述：针对此方法的文字描述，主要是便于其它管理员了解此接口的作用；
返回值类型：接口返回数值的类型，在后期调用接口方法的时候，E-cology字段的类型一致；
参数名称：写在方法之后的参数名称，这些名称也在WebService接口文件中可以看到，如图U2-1-4中的in0~in7；
参数类型：对应参数的类型，在WebService接口文件中可以看到，如图4中type后面跟的就是参数字段的类型；
是否数组：只有数组型的参数才需要选中。
注意：暂时只支持简单参数类型的接口
集成登录
概述
集成登录是通过在E-cology系统中设置自定义的菜单，点击此菜单后可以不用输入用户名和密码直接登录到第三方系统中去，当然前提是用户名和密码已经在指定的地方维护好了。
U3-1-集成登录设置
3.2.1、集成登录列表
点击【集成登录】菜单后显示如图1所示：

U3-1-1
点击【新建】按钮可以创建集成登录配置信息；
选中已有的集成登录配置后点击【删除】按钮可以删除已有的集成登录配置信息；
列表菜单【编辑】和【删除】按钮，点击后可以编辑和删除这一条集成登录配置信息；
列表菜单【测试】按钮点击可以测试单独登录菜单是否有效；
记录单独登录设置的修改记录。
3.2.2、新建集成登录
在图U3-1-1中点击【新建】按钮后显示如图U3-1-2所示：

U3-1-2
类型：选择需要集成的第三方系统的类型，e-cology已经默认集成了NC、EAS、U8、K3等软件的集成接口，如图U3-1-3所示，这些已经写好的软件相关的接口参数信息都配置好了，无需用户再次进行配置，对于其它软件，必需软件供应商提供了单点登录接口，否则是无法实现单点登录功能的；

U3-1-3
标识：通过自定义菜单搭建其他系统入口时的唯一标志，不能有相同的标识；
名称：此集成登录设置所用的名称，这个是自定义的；
链接图标：可以上传一个图标，设置的图标在门户-集成登录元素中会展示，默认大小32*32  可以自行设置；如果未上传图标，那么元素中展示的是默认图标；
内外网自动登录：启用【内外网自动登录】开关后，增加内外IP选择下拉框，如图U3-1-4所示

U3-1-4
下拉选择框中可选【组织权限中心】-【帐户中心】-【安全设置】-【网段策略】中设置的IP段；
点击【添加】，可将选择网段添加到下方的只读列表中；
点击【网段策略】进入组织权限中心的网段策略页面，但需要相应的权限，如果无权限则提示没有权限；
只读列表中点击【删除】可删除所选行；
内网地址、外网地址：其他系统的访问地址，通常情况下保持一致就可以,某些特殊的客户同一个系统可能内网访问和外网访问用的是不同的地址，那么这里要分别设置；
请求方式：有GET和POST两种方式，使用GET方式是将用户记录的用户名和密码附加在第三方系统访问地址后面，有一定风险，而POST方式是将用户名和密码推送到第三方系统中，当然这个就需要第三方系统支持此类方式才可以，采用GET方式的时候由于要将用户名和密码带到地址栏中，如果存在中文的话就会产生编码问题所以如图U3-1-3所示，采用GET方式的时候有编码和不编码的选择，例如：
【http://IP/login/VerifyLogin.jsp?logintype=1&loginid=路飞&userpassword=1】就是不编码的方式
【http://IP/login/VerifyLogin.jsp?logintype=1&loginid=%25C2%25B7%25B7%25C9&userpassword=1】就是编码的方式；
加密算法：如果客户的用户名和密码登录的时候有加密算法，需要在这里进行选择，常用的MD5加密、PBE加密、DES加密、AES加密可以直接选择，如果是其它的算法，在选择了【自定义加密算法】后自行设置；
选择加密算法为“自定义算法”时，如图U3-1-5所示，显示后面的自定义加密算法下拉框，下拉框默认值为设置的第一个自定义加密算法，点击【新建】可打加密算法新建页面，详细设置参见《U3-2-加密算法设置》；

U3-1-5
账号参数名：登录其他系统的的用户名的参数名称【需由第三方提供】，其值可以直接选择直接用ECOLOGY的帐号登陆（如果其他系统的帐号和ECOLOGY帐号一致）或者由客户在使用的时候先输入一次帐号，以后只要在其他系统帐号改变的时候再输入就可以,如果第三方系统需要通过加密传输的话，需要将【是否加密】开启；
密码参数名：登陆其他系统的的口令的参数名称【需由第三方提供】，其值可以直接选择直接用ECOLOGY的密码登陆（如果其他系统的帐号和ECOLOGY密码一致）或者由客户在使用的时候先输入一次密码，以后只要在其他系统密码帐号改变的时候再输入就可以,如果第三方系统需要通过加密传输的话，需要将【是否加密】开启；
单独登录地址：打开单点登录地址的页面；
其它参数：
参数名：为实际登陆到其他系统的时候所需要的参数的名称；
标签：是客户在设置参数值时的一个说明；
参数值：可以从部门（ECOLOGY中的部门ID）、分部（ECOLOGY系统中的分部ID）、固定值（如果选择固定值，必须在后面输入一个值）、用户录入（客户在使用的时候先输入一次）、表达式、表达式参数中选择；
是否加密：如果这些内容需要加密传输，打开此按钮。
3.2.3、表达式设置
参数值选择“表达式”时，后面出现【设置】链接，点击可进入表达式设置，如图U3-1-6所示：

U3-1-6

U3-1-7
点击【保存】按钮，保存设置，并将设置好的表达式填入参数值字段中，如图U3-1-8所示：

U3-1-8
表达式为只读，点击【设置】可进入修改
3.2.4、表达式参数
参数值选择“表达式参数”时，同除表达式外的其他选项一样，后面只带出单行文本输入框，如图U3-1-9所示。

U3-1-9
表达式参数特殊值设置：当前日期，值设置为$date$；当前时间，值设置为$time$；当前日期和时间，值设置为$dateandtime$；1970年1月1日起至当前时间的毫秒数，值设置为$ts$；1970年1月1日起至当前时间的秒数，值设置为$ts_l$。
表达式参数的作用：只作用于设置表达式中使用，并不会作为参数直接传递到第三方系统；
表达式参数除了固定值之外，还可使用特殊值。
计划任务
概述
e-cology提供CronJob接口，此接口在指定的时间点（自己定义时间点）执行任务。
U4-1-计划任务设置
4.2.1、计划任务页面
点击【计划任务】菜单后显示如图U4-1-1所示

U4-1-1
点击【新建】按钮后可以创建新的计划任务；
在列表中编辑了计划任务的信息后必须点击【保存】按钮才可以生效；
选中已有的计划任务后点击【删除】按钮可以删除选中的计划任务。
4.2.2、新建计划任务
在图U4-1-1中点击【新建】按钮后显示如图U4-1-2所示

U4-1-2
“计划任务标识”不能重复；
“计划任务类”必须是类的全名，该类必须实现接口weaver.interfaces.schedule.BaseCronJob的方法public void execute() {}；
“定时时间”格式按Cron表达式的定义。一个Cron表达式包含至少6个有空格分隔的时间元素，按顺序依次为：
秒（0~59）
分钟（0~59）
小时（0~23）
天--每月（0~31，但是需要考虑每个月实际的天数）
月（0~11）
天--每星期（1~7其中1=SUN，2= MON，3= TUE，4=WED，5=THU，6=FRI，7=SAT）或（SUN，MON，TUE，WED，THU，FRI，SAT）
4.2.3、格式说明
定时时间内容补充说明
秒：分为秒和每n秒，秒就是第0秒的时候触发，每n秒显示如图U4-1-3所示，拖拽至需要的数值，每到这个秒就触发动作；

U4-1-3
分钟：分为每分钟、每n分钟和选择分钟，分钟就是0分的时候触发，每n分钟就是每到第几分钟时就触发一次，选择分钟是指到了这个分钟时间点触发；
小时：分为每小时、每n小时和选择小时，小时就是0分的时候触发，每n小时就是每到第几小时时就触发一次，选择小时是指到了这个小时时间点触发；

U4-1-4
日：分为每日和选择日，每日就是每天都触发，选择日就是选择的这一天触发；
月：分为每月和选择月，每月就是每月都触发，选择月就是选择的这一月触发；
年：
定时间阅读举例
定时时间	说明
0 0 10,14,16 * * ?	每天上午10点，下午2点，4点
0 0/30 9-17 * * ?	朝九晚五工作时间内每半小时
0 0 12 ? * WED	每个星期三中午12点
0 0 12 * * ?	每天中午12点触发
0 15 10 ? * *	每天上午10:15触发
0 15 10 * * ?	每天上午10:15触发
0 * 14 * * ?	在每天下午2点到下午2:59期间的每1分钟触发
0 0/5 14 * * ?	在每天下午2点到下午2:55期间的每5分钟触发
0 0/5 14,18 * *	在每天下午2点到2:55期间和下午6点到6:55期间的每5分钟触发
0 0-5 14 * * ?	在每天下午2点到下午2:05期间的每1分钟触发
0 10,44 14 ? 3 WED	每年三月的星期三的下午2:10和2:44触发
0 15 10 ? * MON-FRI	周一至周五的上午10:15触发
0 15 10 15 * ?	每月15日上午10:15触发
0 15 10 L * ?	每月最后一日的上午10:15触发
0 15 10 ? * 6L	每月的最后一个星期五上午10:15触发
0 15 10 ? * 6#3	每月的第三个星期五上午10:15触发

财务凭证
概述
财务凭证是用来管理与e-cology系统集成的财务系统软件接口信息。
U5-1-财务凭证设置
5.2.1、财务凭证列表
点击【财务凭证】菜单后显示如图U5-1-1所示

U5-1-1
点击【新建】按钮后可以创建财务凭证；
选中已有的财务凭证信息后点击【删除】按钮，可以批量删除选中的财务凭证；
列表菜单只有【编辑】和【删除】两个按钮，点击后可以编辑和删除当前的财务凭证。
5.2.2、新建凭证
在图U5-1-1中点击【新建】按钮后显示如图U5-1-2所示，这里是管理e-cology和财务系统接口信息的页面

U5-1-2
名称：当前的财务凭证的名称；
财务系统：选择需要同步的财务系统，目前支持的财务系统有NC5、NC6、U8、K3四种；
接口地址：输入凭证接口文件在服务器上的存放地址，只能NC使用；
编码：如果是NC财务系统需要选择编码方式，有UTF-8、GB2312和GBK三种编码方式；
数据源：需要配置外部数据源，选择U8或K3的数据源；
选择流程：设置需要应用此凭证的流程。
5.2.3、编辑凭证
新建凭证页面仅仅是凭证的基本信息，创建完成后还需要设置凭证的主表信息、借方或贷方信息，如图U5-1-3所示。

U5-1-3
数据流转集成
概述
流程流转集成是用来集中管理在流程中可被调用的三种接口程序，在这里集中进行管理，并可以查看这些接口程序被哪些流程所调用。
U6-1-流程接口注册
点击流程流转接口后显示如图U6-1-1所示

U6-1-1
分别点击【注册DML接口】、【注册WebService接口】、【注册自定义接口】、【注册ESB接口】后可以创建相应的接口配置；
在已有的列表菜单中点击【编辑】按钮可以修改现有的接口信息；
点击【删除】按钮可以删除现有的接口。
U6-2-注册DML接口
6.3.1、基本信息
点击注册DML接口按钮后显示如图U6-2-1所示

U6-2-1
名称：是指这个DML接口的名称；
表单名称：选择系统中的流程表单，表单对应的流程才能关联此DML接口；
数据源：选择需要进行数据交互的数据源，备选数据源必须在【数据源设置】中先设好。若没有设置数据源，表示使用本系统中的数据库表；
DML类型：可选择update 、insert 、delete、自定义类型
选择insert，向外部主表插入数据，需要设置DML赋值设置中的DML赋值设置  或者 自定义DML语句中编写insert语句；
选择update，根据条件更新外部主表的数据，需要设置DML赋值设置中的DML赋值设置、DML触发条件设置（[自定义触发条件]）或者 自定义DML语句中编写update语句；
选择delete，根据条件删除外部主表的数据，需要设置DML赋值设置中的DML触发条件设置（[自定义触发条件]）或者 自定义DML语句中编写delete语句；
选择自定义类型，需要设置自定义DML语句，根据sql语句对外部主表进行插入、更新、删除操作
数据来源：若已选的流程表单有明细表，则可选择明细表，通过流程明细表更改外部主表的数据；
外部主表：需要进行数据交互的数据主表，若没有选择数据源，则可使用本系统中数据库表，如图U6-2-1；若选择了数据源， 则设置数据源中数据库表。执行DML操作，将更改外部主表中的数据，如图U6-2-2所示；

U6-2-2
流程主表 或 流程明细表：只读，显示已选表单的主表或明细表的数据库表名。
6.3.2、条件设置
将表单字段的值赋值给外部主表字段，作为where条件， DML类型选择update或delete需要设置；其中转换规则是表单字段在赋值给外部表之前，允许按照一定的规则进行转换后再赋值。
可自定义设置触发条件，最终会拼接到where条件后面，直接从外部主表字段名开始，不能写where 或and。

U6-2-3
6.3.3、DML赋值设置
将表单字段的值赋值给外部主表字段，DML类型选择insert或update需要设置；其中转换规则是表单字段在赋值给外部表之前，允许按照一定的规则进行转换后再赋值。

U6-2-4
6.3.4、自定义DML语句
可自行编写insert 、update、delete语句，自定义DML语句应该与DML类型相对应，否则会导致DML接口不执行：
DML类型为insert ，自定义DML语句设置insert语句；
DML类型为updae，自定义DML语句设置update语句；
DML类型为delete，自定义DML语句设置delete语句；
DML类型为自定义类型，自定义DML语句设置insert、update、delete语句，会自行判断执行插入、更新、删除操作；
DML赋值设置与自定义DML语句只要设置一边就好，即设置了DML赋值设置就不用设置自定义DML语句了，设置了自定义DML语句就不要设置DML赋值设置了，否则可能导致会执行两遍。若DML类型为自定义类型，只能设置自定义DML语句，否则不会执行。
6.3.5、DML赋值设置之转换规则
DML赋值设置以及DML触发条件中转换规则支持的情况：
浏览按钮-人力资源，选项如下：
固定值——固定的值，在随后的文本框中填写。
显示值——显示值，将数据库中存储的id等，转换为在表单上显示的值，如人力资源字段，将存储的id转换为人员姓名。
人员编号——人力卡片上的员工编号。
登录名——人员的登录名。
手机号码——人力资源卡片上的“移动电话”。
Email——人力资源卡片上的“电子邮件”。
自定义SQL——自己在随后的文本域中输入sql，将值转换，sql支持{?流程表单字段}这种格式的参数。
浏览按钮-部门，选项如下：
固定值——固定的值，在随后的文本框中填写。
显示值——显示值，将数据库中存储的id等，转换为在表单上显示的值，如人力资源字段，将存储的id转换为人员姓名。
部门编号——人力卡片上人员所属部门的编号。
自定义SQL——自己在随后的文本域中输入sql，将值转换，sql支持{?流程表单字段}这种格式的参数。
浏览按钮-分部，选项如下：
固定值——固定的值，在随后的文本框中填写。
显示值——显示值，将数据库中存储的id等，转换为在表单上显示的值，如人力资源字段，将存储的id转换为人员姓名。
分部编号——人力卡片上人员所属分部的编号。
自定义SQL——自己在随后的文本域中输入sql，将值转换，sql支持{?流程表单字段}这种格式的参数。
其他浏览按钮、选择框、附件上传、特殊字段，选项如下：
固定值——固定的值，在随后的文本框中填写。
显示值——显示值，将数据库中存储的id等，转换为在表单上显示的值，如人力资源字段，将存储的id转换为人员姓名。
自定义SQL——自己在随后的文本域中输入sql，将值转换，sql支持{?流程表单字段}这种格式的参数。
以上4种情况之外的字段，选项如下：
固定值——固定的值，在随后的文本框中填写。
自定义SQL——自己在随后的文本域中输入sql，将值转换，sql支持{?流程表单字段}这种格式的参数。
6.3.6、自定义DML语句之获取流程表单字段
编写自定义DML语句时，若需要获取流程表单字段的值，格式为{?字段名称}，字段可相应地查看DML赋值设置-同步对应字段中的字段名称。
获取流程主表字段值：同步对应字段中显示流程主表中文本字段名称为wb，则在自定义DML语句写{?wb}
获取流程明细表字段值：同步对应字段中显示明细表1中文本字段名称为d.wb_mx1，则在自定义DML语句写{?d.wb_mx1}
U6-3-注册WebService接口
6.4.1、基本信息
点击注册WebService接口按钮后显示如图U6-3-1所示

U6-3-1
名称：是指这个WebService接口的名称；
表单名称：选择系统中的流程表单，表单对应的流程才能关联此DML接口；（选择之后将不能修改）
WebService地址：选择需要使用的WebService，WebService必须在【WebService注册】中先设置好。
WebService方法：选择需要使用的WebService方法，WebService方法必须在已选的WebService地址中注册；
WebService命名空间：.net写的webservice接口，需要结合命名空间才能正常调用，在KB81001608版本之后增加了命名空间的输入。
6.4.2、返回值
返回值类型支持字符串和执行sql两种方式，显示如图U6-3-2所示

U6-3-2
字符串：设置返回值，与执行WebService接口获得的返回值进行判断，若相同，则表示执行成功；若不相同，则表示执行失败，流程将流转不下去。
执行SQL：设置SQL语句，利用执行WebService接口获得的返回值，更改OA数据表的数据。
说明：执行SQL只支持WebService接口方法返回值为字符串类型的，返回值标签返回值标签’$retstr$’也是固定格式，不能更改。
6.4.4、参数设置
若WebService方法中参数是需要传递一个XML格式的字符串可在参数设置中设置。
传入参数名称：必须是参数列表中的参数名；
XML模板：输入将WebService方法中的参数XML格式，若需引用流程表单字段，直接点击下面主表字段中字段标签，会自动在鼠标光标位置插入字段标签，如图中的“$field127478$”，XML模板，需要根据实际的WebService接口方法的参数格式进行设置。
数据展现集成
概述
数据展现集成就是通过浏览按钮的方式展示外部数据源的数据，常被用作自定义浏览框的设置和自定义查询菜单的设置。
U7-1-数据展现集成设置
7.2.1、数据展现集成列表
点击【数据展现集成】菜单后显示如图U7-1-1所示

U7-1-1
点击【新建】按钮可以创建新的自定义浏览框；
选中已有的自定义浏览按钮后点击【删除】可以批量删除选中的自定义浏览框；
列表菜单只有【编辑】和【删除】两个按钮，点击后可以编辑和删除当前的自定义浏览框。
7.2.2、新建数据展现集成
在图U7-1-1中点击【新建】按钮后显示如图U7-1-2所示

U7-1-2
标识：自定义数据查询页面的名称，必需是唯一的；
名称：此自定义查询数据的名称，一般用中文表示，告知需要用到此查询功能的用户这个是查询什么内容的；
展现形式：展现形式分为了【浏览框】和【查询页面】两种，浏览框的话可以在流程表单中设置了自定义浏览框类型的字段时调用，查询页面可以在自定义菜单等页面进行调用；
展现方式：选择浏览框中内容的展现方式，只有展现形式是【浏览框】时才需要设置，可以采用列表式、树形方式，如果采用自定义页面的话，显示如图U7-1-3所示，只要直接设置自定义页面地址就可以了，其它信息不用设置了。

U7-1-3
数据来源：数据来源可以分为数据库、WebService接口、自定义接口三种，每种接口配置不完全一样
数据源查询
数据源：查询数据的来源数据库，数据源需要在【数据源设置】中先设好；
查询SQL语句：编写查询语句，控制浏览按钮的查询显示结果；
WebService查询
WebService地址：在WebService注册中记录接口名称，通过下拉选择框选择；
WebService方法：属于这个接口的具体方法；
自定义地址查询
已经在第三方的页面中编写了查询方法，这里直接调用那个查询方法的文件；
主键：查询的主标示字段名称；
外部页面地址：
列表式查询页面中必需设置页面中的查询条件和显示字段列，点击下方的进行添加；
如果是树形展示字段的话，需要制定父字段和子字段在外部数据源中的名称，如图U7-1-4所示。

U7-1-4
IM集成设置
概述
IM集成是E-cology系统与第三方即时聊天工具进行集成设置的页面，目前系统支持RTX和OCS两款企业级即时聊天软件。
RTX是腾讯公司出品的企业版即时聊天软件，RTX集成功能是将E-cology与RTX结合起来，让RTX中的机构、用户的维护在E-cology中完成，而E-cology中的很多提醒如流程提醒等可以通过RTX进行提醒。
除了RTX外，还与另一个聊天软件OCS做了同样的集成功能。
此外，还为其他IM软件与E-cology集成提供了统一的接口。
U8-1-集成设置
点击【IM集成】菜单后显示如图U8-1-1所示

U8-1-1
是否启用：集成的总开关，开启后才会进行集成同步；
类型：RTX和OCS两种软件，根据需要选择，其他IM软件，选择其他
服务器地址：聊天软件安装服务器的IP地址；
服务器对外地址：聊天软件安装服务器的外部IP地址，如果没有外部地址，填写服务器地址即可；
端口号：聊天软件服务器的访问端口号，其中RTX固定为8036，是RTX中间件的端口号；
版本：聊天软件的版本号；
是否同步组织架构及账号：开启后才会自动同步组织架构和账号，当E-cology这里的组织架构和人员发生变化之后，聊天软件同步做出相同的变化；
自动登录：开启后当用户登录了E-cology的时候，会启动聊天软件并自动登录；
流程到达提醒：开启后当用户有新流程到达的时候，RTX会弹出流程到达提醒，点击提醒链接后可以进入流程表单页面。
绑定IM账号：指定OA中人员信息的某个字段和RTX账号绑定，默认为登录名
IM反向登陆：RTX反向登陆OA的地址配置地址【如果要使用，最好进行二开】
取消下载插件：检测是否已装客户端，并提示下载
中间件下载：提供RTX中间件下载，安装在RTX服务器上
所有设置完成后必须点击【保存】按钮后才能生效；
点击【同步】按钮，完成E-cology系统与聊天软件的同步动作；
【测试】按钮是用来测试当前E-cology服务器和IM服务器之间是否连接正常。

Submitted by Weaver
2018-08-24

上海泛微网络科技股份有限公司 www.weaver.com.cn 1
上海市闵行区联航路1188号浦江智谷33号楼
电话：021- 68869298 传真：021-50942278